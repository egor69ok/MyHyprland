# Устанавливаем сам клиент
yay -S outline-client-appimage

# Создаем группу доступа (id 1001 в вашем случае был создан автоматически, но лучше проверить)
sudo groupadd -f outlinevpn
sudo usermod -aG outlinevpn $USER

# Распаковываем установленный AppImage (если еще не распакован)
outline-client --appimage-extract

# Копируем контроллер в системную папку
sudo mkdir -p /usr/local/sbin
sudo cp squashfs-root/resources/app.asar.unpacked/client/electron/linux_proxy_controller/dist/OutlineProxyController /usr/local/sbin/
sudo chmod +x /usr/local/sbin/OutlineProxyController

# Удаляем временную папку распаковки
rm -rf squashfs-root

sudo bash -c 'cat <<EOF > /etc/systemd/system/outline_proxy_controller.service
[Unit]
Description=Outline Proxy Controller
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/sbin/OutlineProxyController --daemonize --socket-filename /var/run/outline_controller --owning-user-id $(getent group outlinevpn | cut -d: -f3)
Restart=always
User=root

[Install]
WantedBy=multi-user.target
EOF'

# Перечитываем и запускаем сервис
sudo systemctl daemon-reload
sudo systemctl enable --now outline_proxy_controller.service

# Создаем ссылку для клиента
sudo ln -sf /var/run/outline_controller /tmp/outline_controller


# //////////////////////////////////////////////////////////////

# Останавливаем и отключаем автозапуск сервиса
sudo systemctl stop outline_proxy_controller.service
sudo systemctl disable outline_proxy_controller.service

# Удаляем файл службы
sudo rm /etc/systemd/system/outline_proxy_controller.service

# Перезагружаем конфигурацию systemd
sudo systemctl daemon-reload

# Удаляем сам контроллер
sudo rm /usr/local/sbin/OutlineProxyController

# Удаляем символическую ссылку и сокет
sudo rm /tmp/outline_controller
sudo rm /var/run/outline_controller

# Удаляем настройки приложения в домашней папке
rm -rf ~/.config/Outline


# иногда нужно после обновления 
sudo systemctl enable --now outline_proxy_controller.service
